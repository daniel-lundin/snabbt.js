<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sticks</title>
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <script src="//cdnjs.cloudflare.com/ajax/libs/randomcolor/0.1.1/randomColor.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fpsmeter/3.0.1/fpsmeter.min.js"></script>
  <script src="dist/snabbt.min.js"></script>
  <style>
    body {
      -webkit-perspective: 2000px;
    }
    @font-face {
      font-family: 'Fira Sans';
      src: url('FiraSans-Thin.otf') format('opentype');
    }
    h1 {
      font-family: 'Fira Sans';
      text-align: center;
      font-size: 2em;
    }
    #c1, #c2 {
      position: absolute;
    }
    .stick {
      position: absolute;
      width: 30px;
      height: 5px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1 id="heading">100 DOM elements</h1>
  <div id="c1">
  </div>
  <div id="fps" style="position: absolute; left: 0px; bottom: 0px;">
  </div>

  <script type="text/javascript">

    var fps = document.getElementById('fps');
    var meter = new FPSMeter(fps, {
        heat: true,
        theme: 'colorful',
        graph: true
    });
    var _master_tick = master_tick;
    master_tick = function(time) {
      _master_tick(time);
      meter.tick();
    }
    
    var c1 = document.getElementById('c1');
    c1.style.top = window.innerHeight/2 + 'px';
    c1.style.left = ((window.innerWidth/2) - 15) + 'px';

    var stick_count = 100;
    function animate(prefix, index) {
      var radius_outer = 100;
      var radius_inner = 50;
      if(index != stick_count - 1)
        return;

      for(var i=0;i<stick_count;++i) {
        var stick = document.getElementById(prefix + i);
        snabbt(stick, {
          from_pos: [0, -(stick_count/2) * 5 + 5*i, 0],
          pos: [radius_outer, 0, 0],
          duration: 500,
          easing: 'cos',
        }).then({
          pos: [radius_outer, 0, 0],
          rot_post: [0, 0, (i/stick_count)*2*Math.PI],// + Math.PI],
          duration: 1000,
          easing: 'cos',
        }).then({
          from_pos: [
            radius_outer*Math.cos((i/stick_count)*2*Math.PI),
            -radius_outer*Math.sin((i/stick_count)*2*Math.PI),
            0
          ],
          pos: [
            radius_inner*Math.cos((i/stick_count)*2*Math.PI),
            -radius_inner*Math.sin((i/stick_count)*2*Math.PI),
            0
          ],
          from_rot: [0, 0, (i/stick_count)*2*Math.PI - 2*Math.PI],
          rot: [0, 0, (i/stick_count)*2*Math.PI - 2*Math.PI],
          from_rot_post: [-2*Math.PI, 0, 0],
          rot_post: [0, 0, 0],
          delay: i*10,
          duration: 2000,
          easing: 'sinc2_wobbler',
        }).then({
          from_pos: [radius_inner, 0, 0],
          pos: [0, -(stick_count/2) * 5 + 5*i, 0],
          from_rot: [0, 0, 0],
          from_rot_post: [0, 0, (i/stick_count)*2*Math.PI],// + Math.PI],
          rot_post: [0, 0, 0],
          easing: 'cos',
          delay: stick_count*10 + i*10,
          duration: 1000,
          callback: (function(j) { return function() { animate(prefix, j) } })(i),
        });
      }
    }
    var colors = randomColor({
      count: 7,
      luminosity: 'dark',
      format: 'rgb'
    });

    function setup_sticks(root, prefix) {
      for(var i=0;i<stick_count;++i) {
        var stick = document.createElement('div');
        stick.className = 'stick';
        stick.style.background = colors[i % colors.length];
        stick.id = prefix + i;
        root.appendChild(stick);
      }
    }
    setup_sticks(c1, 'r');
    animate('r', stick_count - 1);
    //setup_sticks(c2, 'l');
    //animate('l', stick_count - 1);
  </script>
</body>
</html>

